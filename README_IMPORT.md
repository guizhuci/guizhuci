# 桂职测助手 - Word题库导入功能

## 功能概述

实现了智能的Word文档题目解析和导入功能，支持以下题型：
- 单项选择题
- 判断题
- 综合探究题

## 解析逻辑

### 1. 文档格式要求

Word文档应包含以下结构：
```
一、单项选择题
1. 题目内容...
A. 选项1
B. 选项2
C. 选项3
D. 选项4

2. 题目内容...
...

二、判断题
1. 题目内容...
A. 正确 B. 错误

2. 题目内容...
...

三、综合探究题
1. 题目内容...
(1) 小问1
(2) 小问2
(3) 小问3

参考答案

单项选择题
1、参考答案：A
解析：解析内容...

2、参考答案：B
解析：解析内容...
...

判断题
1、参考答案：A
解析：解析内容...

2、参考答案：B
解析：解析内容...
...

综合探究题
1、参考答案：
(1) 答案1
(2) 答案2
(3) 答案3
```

### 2. 解析流程

1. **文档提取**：使用mammoth库将Word文档转换为HTML，再转为纯文本
2. **题目解析**：
   - 识别题型标题（单项选择题、判断题、综合探究题）
   - 提取题目编号、内容、选项
   - 综合探究题合并多个小问为一道大题
3. **答案解析**：
   - 在"参考答案"之后提取答案部分
   - 匹配题目编号与答案编号
   - 提取答案和解析内容
4. **数据合并**：将题目与对应的答案、解析合并

### 3. 关键特性

- **题型分离**：支持选择题、判断题、综合探究题混合
- **答案分离**：题目与答案可以分开在不同位置（"参考答案"前/后）
- **智能匹配**：基于题型和题号自动匹配题目与答案
- **容错处理**：支持多种编号格式（1.、1、等）

## 使用方法

### 1. 后端API接口

**接口路径**：`POST /api/admin/questions/import`

**请求参数**：
- `file`: Word文档文件（.docx格式）
- `subjectId`: 科目ID（整数）

**返回结果**：
```json
{
  "success": true,
  "imported": 21,
  "total": 21
}
```

### 2. 配置要求

在环境变量中配置数据库连接：
```bash
DATABASE_URL=postgresql://user:password@host:port/database
```

### 3. 数据库表结构

```sql
CREATE TABLE questions (
  id SERIAL PRIMARY KEY,
  subject_id INTEGER NOT NULL,
  type VARCHAR(20) NOT NULL,  -- single_choice, judge, essay
  question_text TEXT NOT NULL,
  options JSONB,
  answer VARCHAR(200),
  explanation TEXT,
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 测试结果

使用提供的`信息技术.docx`测试文档：
- **总题数**：21道
  - 单项选择题：10道
  - 判断题：10道
  - 综合探究题：1道
- **答案匹配率**：100%（21/21）
- **解析匹配率**：95%（20/21，综合探究题解析格式特殊）

## 注意事项

1. **文档格式**：
   - 必须使用.docx格式（不支持.doc）
   - 题目和答案必须分离（"参考答案"分隔）
   - 题号格式必须统一（1. 或 1、）

2. **题型支持**：
   - 选择题必须为4个选项（A、B、C、D）
   - 判断题选项固定为"正确"和"错误"
   - 综合探究题合并为1道大题

3. **限制**：
   - 不支持多选题、填空题等其他题型
   - 不支持图片、公式等复杂内容
   - 答案格式必须明确（参考答案：xxx）

## 扩展建议

如需支持更多题型或功能，可以考虑：
1. 添加多选题支持（如"多选题"题型识别）
2. 支持图片识别和保存
3. 支持公式解析（LaTeX格式）
4. 添加题目预览功能
5. 支持批量导入多个文档

## 联系方式

如有问题或建议，请联系开发团队。
